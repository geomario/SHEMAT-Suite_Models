import unittest
import numpy.testing as npt

try:
    import SHEMATtest_dirs as std
except ImportError:
    raise ImportError('No module named SHEMATtest_dirs. \n\n' + 'Solution: ' +
                      ' Add the path /path-to-SHEMAT-Suite_Models/' +
                      'SHEMAT-Suite_Models/deltatests/site-packages to the' +
                      ' PYTHONPATH.')

try:
    from pskf.tools.plot import plotfunctions as pf
except ImportError:
    raise ImportError(
        'No module named pskf.tools.plot.plotfunctions. \n\n' + 'Solution: ' +
        'Download pyshemkf from https://github.com/jjokella/pyshemkf and add' +
        ' the path /path-to-pyshemkf/pyshemkf/site-packages to the' +
        ' PYTHONPATH.')


class Tests_ad_const_TemperatureInversion(unittest.TestCase):
    def test_uindex_equal(self):

        uindex_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir +
                '/ad_const_TemperatureInversion/result', 'oed_inv_final.vtk',
                'uindex'))
        uindex_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/ad_const_TemperatureInversion',
                'oed_inv_final.vtk', 'uindex'))

        npt.assert_allclose(
            uindex_array_actual, uindex_array_desired, rtol=1e-5)


def local_suite():
    local_suite = unittest.makeSuite(
        Tests_ad_const_TemperatureInversion, prefix='test')
    return local_suite


def local_run():
    runner = unittest.TextTestRunner(verbosity=2)
    runner.run(local_suite())


if __name__ == "__main__":
    local_run()
