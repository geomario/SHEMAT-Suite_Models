import unittest
import numpy.testing as npt

try:
    import SHEMATtest_dirs as std
except ImportError:
    raise ImportError('No module named SHEMATtest_dirs. \n\n' + 'Solution: ' +
                      ' Add the path /path-to-SHEMAT-Suite_Models/' +
                      'SHEMAT-Suite_Models/deltatests/site-packages to the' +
                      ' PYTHONPATH.')

try:
    from pskf.tools.plot import plotfunctions as pf
except ImportError:
    raise ImportError(
        'No module named pskf.tools.plot.plotfunctions. \n\n' + 'Solution: ' +
        'Download pyshemkf from https://github.com/jjokella/pyshemkf and add' +
        ' the path /path-to-pyshemkf/pyshemkf/site-packages to the' +
        ' PYTHONPATH.')


class Tests_fw_basc_SaltFlow_small(unittest.TestCase):
    def test_uindex_equal(self):

        uindex_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'uindex'))
        uindex_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'uindex'))

        npt.assert_allclose(
            uindex_array_actual, uindex_array_desired, rtol=1e-5)

    def test_por_equal(self):

        por_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'por'))
        por_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'por'))

        npt.assert_allclose(por_array_actual, por_array_desired, rtol=1e-5)

    def test_head_equal(self):

        head_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'head'))
        head_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'head'))

        npt.assert_allclose(head_array_actual, head_array_desired, rtol=1e-5)

    def test_pres_equal(self):

        pres_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'pres'))
        pres_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'pres'))

        npt.assert_allclose(pres_array_actual, pres_array_desired, rtol=1e-5)

    def test_kx_equal(self):

        kx_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'kx'))
        kx_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'kx'))

        npt.assert_allclose(kx_array_actual, kx_array_desired, rtol=1e-5)

    def test_ky_equal(self):

        ky_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'ky'))
        ky_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'ky'))

        npt.assert_allclose(ky_array_actual, ky_array_desired, rtol=1e-5)

    def test_kz_equal(self):

        kz_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'kz'))
        kz_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'kz'))

        npt.assert_allclose(kz_array_actual, kz_array_desired, rtol=1e-5)

    def test_rhof_equal(self):

        rhof_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'rhof'))
        rhof_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'rhof'))

        npt.assert_allclose(rhof_array_actual, rhof_array_desired, rtol=1e-5)

    def test_tracer1_equal(self):

        tracer1_array_desired = pf.my_vtk_to_numpy(
            pf.my_vtk(
                std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small/result',
                'salt_small_final.vtk', 'tracer1'))
        tracer1_array_actual = pf.my_vtk_to_numpy(
            pf.my_vtk(std.shemat_suite_models_dir + '/fw_basc_SaltFlow_small',
                      'salt_small_final.vtk', 'tracer1'))

        npt.assert_allclose(
            tracer1_array_actual, tracer1_array_desired, rtol=1e-5)


def local_suite():
    local_suite = unittest.makeSuite(
        Tests_fw_basc_SaltFlow_small, prefix='test')
    return local_suite


def local_run():
    runner = unittest.TextTestRunner(verbosity=2)
    runner.run(local_suite())


if __name__ == "__main__":
    local_run()
